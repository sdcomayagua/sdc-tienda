<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
  <title>Soluciones Digitales Comayagua | CatÃ¡logo</title>

  <!-- CSS externo (el que te di completo) -->
  <link rel="stylesheet" href="./assets/css/styles.css?v=2026" />

  <link rel="preconnect" href="https://script.google.com">
  <link rel="dns-prefetch" href="https://script.google.com">
  <meta name="theme-color" content="#0b57ff" />
</head>

<body>
  <!-- ===== TOPBAR ===== -->
  <header class="topbar">
    <div class="brand" id="brandHome" title="Ir al inicio">
      <div class="logo" id="logoText">SDC</div>
      <div class="brandText">
        <a id="storeName" href="javascript:void(0)">Soluciones Digitales Comayagua</a>
        <div id="storeSub">CatÃ¡logo</div>
      </div>
    </div>

    <div class="topActions">
      <button class="iconBtn" id="btnSearch" title="Buscar">ðŸ”Ž</button>
      <button class="iconBtn" id="btnTheme" title="DÃ­a/Noche">ðŸŒ™</button>
      <button class="cartBtn" id="btnCart" title="Carrito">
        ðŸ›’ <span class="badge" id="cartCount">0</span>
      </button>
    </div>
  </header>

  <!-- ===== LOADING ===== -->
  <div id="loadingBlock" class="loadingWrap" style="display:none">
    <div class="spinner"></div>
    <div class="loadingTitle">Cargando catÃ¡logoâ€¦</div>
    <div class="loadingSub">Un momento por favor</div>
  </div>

  <!-- ===== CATEGORÃAS ===== -->
  <nav class="chips" id="chips"></nav>

  <!-- ===== SUBCATEGORÃAS ===== -->
  <nav class="subchips" id="subchips" style="display:none"></nav>

  <!-- ===== SEARCH ===== -->
  <div class="searchWrap">
    <input class="search" id="searchInput" placeholder="Buscar productos, nombre o descripciÃ³nâ€¦" />
  </div>

  <div class="sectionHeader">
    <div class="sectionTitle" id="sectionTitle">Productos</div>
    <div class="btnRow">
      <button class="btn btnMini" id="btnViewAll" style="display:none">Ver todo</button>
      <button class="btn btnMini" id="btnShareCategory" style="display:none">ðŸ”— Compartir</button>
      <button class="btn btnMini" id="btnShareSub" style="display:none">ðŸ”— Sub</button>
    </div>
  </div>

  <!-- ===== GRID ===== -->
  <div class="gridWrap">
    <div class="grid" id="grid"></div>
  </div>

  <!-- ===== WhatsApp FLOAT ===== -->
  <a class="waFloat" id="waFloat" href="#" target="_blank" rel="noopener">WhatsApp</a>

  <!-- ===== BACKDROP ===== -->
  <div class="modalBackdrop" id="backdrop"></div>

  <!-- ===========================
       PRODUCT MODAL
  ============================ -->
  <div class="modal" id="prodModal" aria-hidden="true">
    <div class="modalHeader">
      <div>
        <div class="modalTitle" id="modalName">Producto</div>
        <div class="modalSub" id="modalSub">â€”</div>
      </div>
      <button class="closeBtn" id="prodClose" aria-label="Cerrar">âœ•</button>
    </div>

    <div class="modalBody">
      <div class="prodWrap">
        <div>
          <img class="prodMainImg" id="modalMainImg" src="" alt="">
          <div class="thumbs" id="modalThumbs" style="display:none"></div>
        </div>

        <div>
          <div class="priceRow">
            <div class="price" id="modalPrice">Lps. 0</div>
            <div class="old" id="modalOld"></div>
          </div>

          <div class="prodMeta" id="modalDesc"></div>
          <div class="videoBtns" id="modalVideos" style="display:none"></div>

          <div class="hint" id="modalHint"></div>

          <div class="btnRow" style="margin-top:10px">
            <button class="btn btnPrimary btnFull" id="btnAddCart">Agregar al carrito</button>
            <button class="btn btnSoft btnFull" id="btnCopyProd">Copiar enlace</button>
            <button class="btn btnSoft btnFull" id="btnShareProdWA">WhatsApp</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===========================
       CART MODAL (3 pasos)
  ============================ -->
  <div class="modal" id="cartModal" aria-hidden="true">
    <div class="modalHeader">
      <div>
        <div class="modalTitle">Carrito y pedido</div>
        <div class="modalSub" id="cartSub">Revisa tu pedido</div>
      </div>
      <button class="closeBtn" id="cartClose" aria-label="Cerrar">âœ•</button>
    </div>

    <div class="modalBody">
      <div id="cartStep1">
        <div id="cartEmpty" class="cartEmpty" style="display:none">Tu carrito estÃ¡ vacÃ­o.</div>
        <div class="cartList" id="cartList"></div>

        <div class="totals">
          <div class="row"><span>Subtotal</span><span id="cartSubtotal">Lps. 0</span></div>
          <div class="row"><span>EnvÃ­o / Entrega</span><span id="cartShip">Lps. 0</span></div>
          <div class="row total"><span>Total</span><span id="cartTotal">Lps. 0</span></div>
        </div>

        <div class="hint">Luego toca <b>Continuar</b> para elegir entrega y pago.</div>
      </div>

      <div id="cartStep2" style="display:none">
        <div class="form">
          <div class="field">
            <label>Â¿DÃ³nde estÃ¡s?</label>
            <select class="select" id="locType">
              <option value="comayagua">En Comayagua (entrega local)</option>
              <option value="fuera">Otro departamento (envÃ­o)</option>
            </select>
            <div class="smallMuted" id="locHelp"></div>
          </div>

          <!-- COMAYAGUA -->
          <div id="comayaguaBlock">
            <div class="field">
              <label>Zona / Municipio (entrega local)</label>
              <select class="select" id="localZone"></select>
              <div class="smallMuted" id="zoneExamples"></div>
            </div>

            <div class="field">
              <label>MÃ©todo de pago (Comayagua)</label>
              <select class="select" id="payLocal">
                <option value="efectivo">Pagar al recibir (efectivo)</option>
                <option value="transferencia">Transferencia bancaria</option>
                <option value="paypal">PayPal</option>
                <option value="tigo">Tigo Money</option>
              </select>
            </div>

            <div class="field" id="cashBlock">
              <label>Â¿Con cuÃ¡nto pagarÃ¡s? (Cambio estimado)</label>
              <input class="input" id="cashWith" inputmode="numeric" placeholder="Ej: 1000" />
              <div class="smallMuted" id="cashChange"></div>
            </div>

            <div class="field" id="bankBlock" style="display:none">
              <label>Elige el banco</label>
              <select class="select" id="bankSelect"></select>
              <div class="smallMuted" id="bankInfo"></div>
            </div>

            <div class="field" id="paypalBlock" style="display:none">
              <label>PayPal</label>
              <div class="smallMuted" id="paypalInfo"></div>
            </div>

            <div class="field" id="tigoBlock" style="display:none">
              <label>Tigo Money</label>
              <div class="smallMuted" id="tigoInfo"></div>
            </div>
          </div>

          <!-- FUERA -->
          <div id="fueraBlock" style="display:none">
            <div class="field">
              <label>Departamento</label>
              <select class="select" id="deptSelect"></select>
            </div>
            <div class="field">
              <label>Municipio</label>
              <select class="select" id="muniSelect"></select>
            </div>

            <div class="field">
              <label>Tipo de envÃ­o</label>
              <select class="select" id="shipType">
                <option value="empresa">Empresa (Cargo/Forza/C807)</option>
                <option value="bus">Bus / encomienda (rango)</option>
              </select>
              <div class="smallMuted" id="shipTypeHelp"></div>
            </div>

            <div id="empresaBlock">
              <div class="field">
                <label>Empresa</label>
                <select class="select" id="courierSelect"></select>
              </div>
              <div class="field">
                <label>Servicio</label>
                <select class="select" id="courierService">
                  <option value="normal">Normal (pago anticipado)</option>
                  <option value="cod">Contra entrega (pagar al recibir)</option>
                </select>
              </div>
              <div class="smallMuted" id="courierInfo"></div>

              <div class="field">
                <label>MÃ©todo de pago</label>
                <select class="select" id="payFuera">
                  <option value="transferencia">Transferencia bancaria</option>
                  <option value="paypal">PayPal</option>
                  <option value="tigo">Tigo Money</option>
                  <option value="cod">Pagar al recibir (contra entrega)</option>
                </select>
              </div>

              <div class="field" id="bankBlock2">
                <label>Elige el banco</label>
                <select class="select" id="bankSelect2"></select>
                <div class="smallMuted" id="bankInfo2"></div>
              </div>

              <div class="field" id="paypalBlock2" style="display:none">
                <label>PayPal</label>
                <div class="smallMuted" id="paypalInfo2"></div>
              </div>

              <div class="field" id="tigoBlock2" style="display:none">
                <label>Tigo Money</label>
                <div class="smallMuted" id="tigoInfo2"></div>
              </div>
            </div>

            <div id="busBlock" style="display:none">
              <div class="field">
                <label>Encomienda por bus (rango)</label>
                <div class="smallMuted" id="busInfo"></div>
              </div>
              <div class="field">
                <label>MÃ©todo de pago</label>
                <select class="select" id="payBus">
                  <option value="transferencia">Transferencia bancaria</option>
                  <option value="paypal">PayPal</option>
                  <option value="tigo">Tigo Money</option>
                </select>
              </div>

              <div class="field" id="bankBlock3">
                <label>Elige el banco</label>
                <select class="select" id="bankSelect3"></select>
                <div class="smallMuted" id="bankInfo3"></div>
              </div>

              <div class="field" id="paypalBlock3" style="display:none">
                <label>PayPal</label>
                <div class="smallMuted" id="paypalInfo3"></div>
              </div>

              <div class="field" id="tigoBlock3" style="display:none">
                <label>Tigo Money</label>
                <div class="smallMuted" id="tigoInfo3"></div>
              </div>
            </div>
          </div>

          <div class="field">
            <label>Nombre y apellido</label>
            <input class="input" id="custName" placeholder="Ej: Juan PÃ©rez" />
          </div>
          <div class="field">
            <label>DirecciÃ³n / Referencias</label>
            <textarea id="custAddr" placeholder="Ej: Barrio, colonia, referencia, punto exacto..."></textarea>
          </div>
          <div class="field">
            <label>TelÃ©fono (opcional)</label>
            <input class="input" id="custPhone" inputmode="tel" placeholder="Ej: +504 ..." />
          </div>
        </div>
      </div>

      <div id="cartStep3" style="display:none">
        <div class="hint" style="margin-top:0">
          Revisa el resumen y envÃ­a el pedido por WhatsApp.
        </div>
        <div class="totals" style="margin-top:10px">
          <div class="row"><span>Subtotal</span><span id="sumSubtotal">Lps. 0</span></div>
          <div class="row"><span>EnvÃ­o/Entrega</span><span id="sumShip">Lps. 0</span></div>
          <div class="row total"><span>Total</span><span id="sumTotal">Lps. 0</span></div>
        </div>
        <div class="hint" id="sumDetails"></div>
      </div>
    </div>

    <div class="modalFooter">
      <button class="btn btnSoft" id="cartBack">AtrÃ¡s</button>
      <button class="btn btnPrimary" id="cartNext">Continuar</button>
    </div>
  </div>

<script>
/* =====================================================
   CONFIG
===================================================== */
const API_URL = "https://script.google.com/macros/s/AKfycbytPfD9mq__VO7I2lnpBsqdCIT119ZT0zVyz0eeVjrJVgN_q8FYGgmqY6G66C2m67Pa4g/exec";
const CART_KEY = "sdc_cart_v2026";
let DATA = null;
let CART = [];
let CURRENT_CAT = null;
let CURRENT_SUB = null;
let STEP = 1;

/* =====================================================
   UTILIDADES
===================================================== */
const qs = s => document.querySelector(s);
const qsa = s => [...document.querySelectorAll(s)];
const money = n => `Lps. ${Number(n||0).toLocaleString("es-HN")}`;

function saveCart(){
  localStorage.setItem(CART_KEY, JSON.stringify(CART));
  qs("#cartCount").textContent = CART.reduce((a,b)=>a+b.qty,0);
}

function loadCart(){
  try{ CART = JSON.parse(localStorage.getItem(CART_KEY)) || []; }
  catch{ CART=[] }
  saveCart();
}

function toast(msg){
  alert(msg);
}

/* =====================================================
   TEMA DÃA / NOCHE
===================================================== */
const themeBtn = qs("#btnTheme");
const themeSaved = localStorage.getItem("sdc_theme");
if(themeSaved==="light"){ document.body.classList.add("light"); themeBtn.textContent="â˜€ï¸"; }

themeBtn.onclick = ()=>{
  document.body.classList.toggle("light");
  const light = document.body.classList.contains("light");
  localStorage.setItem("sdc_theme", light?"light":"dark");
  themeBtn.textContent = light?"â˜€ï¸":"ðŸŒ™";
};

/* =====================================================
   MODALES
===================================================== */
const backdrop = qs("#backdrop");

function openModal(m){
  backdrop.classList.add("show");
  m.classList.add("show");
}
function closeModal(m){
  backdrop.classList.remove("show");
  m.classList.remove("show");
}

qs("#prodClose").onclick = ()=>closeModal(qs("#prodModal"));
qs("#cartClose").onclick = ()=>closeModal(qs("#cartModal"));
backdrop.onclick = ()=>{
  closeModal(qs("#prodModal"));
  closeModal(qs("#cartModal"));
};

/* =====================================================
   CARGAR API
===================================================== */
async function loadAPI(){
  qs("#loadingBlock").style.display="flex";
  const r = await fetch(API_URL);
  DATA = await r.json();
  qs("#loadingBlock").style.display="none";
  initUI();
}

/* =====================================================
   CATEGORÃAS Y SUBCATEGORÃAS
===================================================== */
function buildCategories(){
  const chips = qs("#chips");
  chips.innerHTML="";

  DATA.categorias
    .filter(c=>c.visible)
    .sort((a,b)=>a.orden-b.orden)
    .forEach(cat=>{
      const b=document.createElement("button");
      b.className="chip";
      b.textContent=cat.categoria;
      b.onclick=()=>{
        CURRENT_CAT = cat.categoria;
        CURRENT_SUB = null;
        buildSubcategories();
        renderProducts();
        highlightChips();
      };
      chips.appendChild(b);
    });
}

function buildSubcategories(){
  const wrap = qs("#subchips");
  wrap.innerHTML="";
  if(!CURRENT_CAT){ wrap.style.display="none"; return; }

  const subs = [...new Set(
    DATA.productos
      .filter(p=>p.categoria===CURRENT_CAT)
      .map(p=>p.subcategoria)
      .filter(Boolean)
  )];

  if(subs.length===0){ wrap.style.display="none"; return; }
  wrap.style.display="flex";

  const all=document.createElement("button");
  all.className="chip";
  all.textContent="Todas";
  all.onclick=()=>{ CURRENT_SUB=null; renderProducts(); highlightChips(); };
  wrap.appendChild(all);

  subs.forEach(s=>{
    const b=document.createElement("button");
    b.className="chip";
    b.textContent=s;
    b.onclick=()=>{
      CURRENT_SUB=s;
      renderProducts();
      highlightChips();
    };
    wrap.appendChild(b);
  });
}

function highlightChips(){
  qsa(".chips .chip").forEach(c=>{
    c.classList.toggle("active", c.textContent===CURRENT_CAT);
  });
  qsa(".subchips .chip").forEach(c=>{
    c.classList.toggle("active", c.textContent===CURRENT_SUB || (!CURRENT_SUB && c.textContent==="Todas"));
  });
}

/* =====================================================
   GRID PRODUCTOS
===================================================== */
function renderProducts(){
  const grid=qs("#grid");
  grid.innerHTML="";

  let list=[...DATA.productos];

  if(CURRENT_CAT) list=list.filter(p=>p.categoria===CURRENT_CAT);
  if(CURRENT_SUB) list=list.filter(p=>p.subcategoria===CURRENT_SUB);

  list.sort((a,b)=>{
    if(a.stock===0 && b.stock>0) return 1;
    if(a.stock>0 && b.stock===0) return -1;
    return a.orden-b.orden;
  });

  qs("#sectionTitle").textContent=`Productos (${list.length})`;

  list.forEach(p=>{
    const card=document.createElement("div");
    card.className="card";

    if(p.stock===0) card.classList.add("agotado");
    if(p.oferta) card.classList.add("oferta");

    card.innerHTML=`
      <img src="${p.imagen}" alt="">
      <div class="cardBody">
        <div class="cardTitle">${p.nombre}</div>
        <div class="cardDesc">${p.descripcion||""}</div>
        <div class="priceRow">
          <div class="price">${money(p.precio)}</div>
          ${p.precio_anterior?`<div class="old">${money(p.precio_anterior)}</div>`:""}
        </div>
        ${p.stock>0
          ?`<button class="btn btnPrimary">Ver detalles</button>`
          :`<button class="btn btnDisabled">Agotado</button>`}
      </div>
    `;

    if(p.stock>0){
      card.querySelector("button").onclick=()=>openProduct(p);
    }
    grid.appendChild(card);
  });
}

/* =====================================================
   PRODUCTO
===================================================== */
function openProduct(p){
  qs("#modalName").textContent=p.nombre;
  qs("#modalSub").textContent=`${p.categoria}${p.subcategoria?" Â· "+p.subcategoria:""}`;
  qs("#modalMainImg").src=p.imagen;
  qs("#modalPrice").textContent=money(p.precio);
  qs("#modalOld").textContent=p.precio_anterior?money(p.precio_anterior):"";
  qs("#modalDesc").textContent=p.descripcion||"";

  qs("#btnAddCart").onclick=()=>{
    const found=CART.find(i=>i.id===p.id);
    if(found){ found.qty++; }
    else CART.push({id:p.id,nombre:p.nombre,precio:p.precio,qty:1});
    saveCart();
    closeModal(qs("#prodModal"));
    openCart();
  };

  openModal(qs("#prodModal"));
}

/* =====================================================
   CARRITO
===================================================== */
function openCart(){
  STEP=1;
  renderCart();
  openModal(qs("#cartModal"));
}

qs("#btnCart").onclick=openCart;

function renderCart(){
  qs("#cartStep1").style.display="block";
  qs("#cartStep2").style.display="none";
  qs("#cartStep3").style.display="none";

  const list=qs("#cartList");
  list.innerHTML="";

  if(CART.length===0){
    qs("#cartEmpty").style.display="block";
    qs("#cartSubtotal").textContent=money(0);
    qs("#cartTotal").textContent=money(0);
    return;
  }
  qs("#cartEmpty").style.display="none";

  let subtotal=0;
  CART.forEach(i=>{
    subtotal+=i.precio*i.qty;
    const row=document.createElement("div");
    row.className="cartRow";
    row.innerHTML=`
      <div>
        <div>${i.nombre}</div>
        <small>${money(i.precio)}</small>
      </div>
      <div class="qty">
        <button>-</button>
        <span>${i.qty}</span>
        <button>+</button>
      </div>
    `;
    const [m,p]=row.querySelectorAll("button");
    m.onclick=()=>{ i.qty=Math.max(1,i.qty-1); saveCart(); renderCart(); };
    p.onclick=()=>{ i.qty++; saveCart(); renderCart(); };
    list.appendChild(row);
  });

  qs("#cartSubtotal").textContent=money(subtotal);
  qs("#cartTotal").textContent=money(subtotal);
}

/* =====================================================
   CONTINUAR / ATRÃS
===================================================== */
qs("#cartNext").onclick=()=>{
  if(STEP===1){ STEP=2; qs("#cartStep1").style.display="none"; qs("#cartStep2").style.display="block"; }
  else if(STEP===2){ STEP=3; qs("#cartStep2").style.display="none"; qs("#cartStep3").style.display="block"; }
};

qs("#cartBack").onclick=()=>{
  if(STEP===2){ STEP=1; renderCart(); }
  else if(STEP===3){ STEP=2; qs("#cartStep3").style.display="none"; qs("#cartStep2").style.display="block"; }
};

/* =====================================================
   INIT
===================================================== */
function initUI(){
  buildCategories();
  renderProducts();
}

loadCart();
loadAPI();
</script>

</body>
</html>