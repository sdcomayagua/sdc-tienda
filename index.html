<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>SDComayagua | Cat√°logo</title>

  <!-- META -->
  <meta name="theme-color" content="#0b1220" />
  <meta name="description" content="Cat√°logo oficial de Soluciones Digitales Comayagua" />

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- ICONOS -->
  <link rel="icon" type="image/png" href="assets/img/logo.png" />
</head>

<body class="dark">

<!-- =========================
HEADER
========================= -->
<header class="topbar">
  <div class="brand">
    <div class="logo">SDC</div>
    <div class="brand-text">
      <strong>SDComayagua</strong>
      <span>Cat√°logo</span>
    </div>
  </div>

  <div class="top-actions">
    <button id="btnSearch" class="icon-btn" aria-label="Buscar">
      üîç
    </button>

    <button id="btnTheme" class="icon-btn" aria-label="Modo d√≠a/noche">
      üåô
    </button>

    <button id="btnCart" class="icon-btn cart-btn" aria-label="Carrito">
      üõí
      <span id="cartCount" class="cart-count">0</span>
    </button>
  </div>
</header>

<!-- =========================
BUSCADOR
========================= -->
<section class="search-box">
  <input
    type="text"
    id="searchInput"
    placeholder="Buscar producto..."
    autocomplete="off"
  />
</section>

<!-- =========================
CATEGOR√çAS PRINCIPALES
(OJO: aqu√≠ NO va el bot√≥n TODAS,
ese solo va en subcategor√≠as)
========================= -->
<section class="categories" id="categories">
  <!-- din√°mico -->
</section>

<!-- =========================
SUBCATEGOR√çAS
(AQU√ç s√≠ va TODAS)
========================= -->
<section class="subcategories" id="subcategories">
  <!-- din√°mico -->
</section>

<!-- =========================
T√çTULO SECCI√ìN
========================= -->
<section class="section-title">
  <h2 id="productsTitle">Productos</h2>
</section>

<!-- =========================
GRID DE PRODUCTOS
========================= -->
<main class="products-grid" id="productsGrid">
  <!-- tarjetas din√°micas -->
</main>

<!-- =========================
BOT√ìN WHATSAPP FLOTANTE
========================= -->
<a
  href="https://wa.me/50431517755"
  target="_blank"
  class="whatsapp-float"
  aria-label="WhatsApp"
>
  WhatsApp
</a>

<!-- =========================
OVERLAY GENERAL
========================= -->
<div id="overlay" class="overlay hidden"></div>
<!-- =========================
MODAL PRODUCTO (DETALLES)
========================= -->
<section id="productModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-header">
    <div class="modal-header-text">
      <h3 id="modalProductName">Producto</h3>
      <p id="modalProductSub">Categor√≠a ¬∑ Subcategor√≠a</p>
    </div>
    <button id="closeProductModal" class="modal-close" aria-label="Cerrar">‚úï</button>
  </div>

  <div class="modal-body">
    <div class="product-media">
      <img id="modalMainImage" class="product-main-image" src="" alt="Producto" />
      <div id="modalThumbs" class="product-thumbs hidden"></div>
    </div>

    <div class="product-info">
      <div class="product-price">
        <span id="modalPrice" class="price">Lps. 0</span>
        <span id="modalOldPrice" class="old-price"></span>
      </div>

      <p id="modalDesc" class="product-desc"></p>

      <div id="modalVideoButtons" class="video-buttons hidden"></div>

      <p id="modalHint" class="hint"></p>

      <div class="product-actions">
        <button id="btnAddToCart" class="btn primary">Agregar al carrito</button>
        <button id="btnKeepBuying" class="btn soft">Seguir comprando</button>
        <button id="btnGoPay" class="btn soft">Ir a pagar</button>
      </div>
    </div>
  </div>
</section>

<!-- =========================
MODAL CARRITO (1-2-3)
========================= -->
<section id="cartModal" class="modal hidden" role="dialog" aria-modal="true">
  <div class="modal-header">
    <div class="modal-header-text">
      <h3>Carrito y pedido</h3>
      <p>1-2-3</p>
    </div>
    <button id="closeCartModal" class="modal-close" aria-label="Cerrar">‚úï</button>
  </div>

  <div class="modal-body">
    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" id="tabStep1">Carrito</button>
      <button class="tab" id="tabStep2">Entrega</button>
      <button class="tab" id="tabStep3">Pago</button>
    </div>

    <!-- STEP 1 -->
    <div id="step1" class="step">
      <div id="cartEmpty" class="empty-box hidden">Tu carrito est√° vac√≠o.</div>
      <div id="cartItems" class="cart-items"></div>

      <div class="totals">
        <div class="row">
          <span>Subtotal</span>
          <span id="subtotalValue">Lps. 0</span>
        </div>
        <div class="row">
          <span>Env√≠o</span>
          <span id="shippingValue">Lps. 0</span>
        </div>
        <div class="row total">
          <span>Total</span>
          <span id="totalValue">Lps. 0</span>
        </div>
      </div>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="step hidden">
      <p class="hint">
        Paso Entrega: aqu√≠ vamos a poner tus reglas (Comayagua / fuera / empresa / bus) cuando me mandes el audio.
      </p>

      <div class="form">
        <label>Nombre</label>
        <input id="custName" type="text" placeholder="Tu nombre" />

        <label>Tel√©fono</label>
        <input id="custPhone" type="tel" placeholder="Ej: 9999-9999" />

        <label>Direcci√≥n / Referencia</label>
        <textarea id="custAddress" placeholder="Ej: barrio, colonia, referencia..."></textarea>
      </div>
    </div>

    <!-- STEP 3 -->
    <div id="step3" class="step hidden">
      <p class="hint">
        Paso Pago: se ajusta con tus reglas exactas (efectivo con cambio en Comayagua, transferencia, PayPal, Tigo, contra entrega).
      </p>

      <button id="btnSendWhatsApp" class="btn primary full">Enviar por WhatsApp</button>
    </div>
  </div>

  <div class="modal-footer">
    <button id="btnBack" class="btn soft">Atr√°s</button>
    <button id="btnNext" class="btn primary">Continuar</button>
  </div>
</section>

<script>
/* =========================================================
   SDC - PARTE 3/3 (JS completo)
========================================================= */

const API_URL = "https://script.google.com/macros/s/AKfycbytPfD9mq__VO7I2lnpBsqdCIT119ZT0zVyz0eeVjrJVgN_q8FYGgmqY6G66C2m67Pa4g/exec";
const CART_KEY = "sdc_cart_v1";
const THEME_KEY = "sdc_theme_v1";
const WA_NUMBER = "50431517755";

/* ===== Helpers ===== */
const $ = (id)=>document.getElementById(id);
const safe = (v)=>String(v ?? "").trim();
const money = (n)=>`Lps. ${Math.round(Number(n||0)).toLocaleString("es-HN")}`;
const isOffer = (p)=>Number(p.precio_anterior||0) > Number(p.precio||0);
const isOut   = (p)=>Number(p.stock||0) <= 0;

/* ===== DOM ===== */
const overlay = $("overlay");
const grid = $("productsGrid");
const catsWrap = $("categories");
const subWrap = $("subcategories");
const searchInput = $("searchInput");
const productsTitle = $("productsTitle");

const productModal = $("productModal");
const cartModal = $("cartModal");
const modalMainImage = $("modalMainImage");
const modalThumbs = $("modalThumbs");
const modalVideoButtons = $("modalVideoButtons");

const modalProductName = $("modalProductName");
const modalProductSub = $("modalProductSub");
const modalPrice = $("modalPrice");
const modalOldPrice = $("modalOldPrice");
const modalDesc = $("modalDesc");
const modalHint = $("modalHint");

const btnAddToCart = $("btnAddToCart");
const btnKeepBuying = $("btnKeepBuying");
const btnGoPay = $("btnGoPay");

const cartEmpty = $("cartEmpty");
const cartList = $("cartList");
const cartSubtotalEl = $("cartSubtotal");
const cartTotalEl = $("cartTotal");

const btnNext = $("cartNext");
const btnBack = $("cartBack");

const step1 = $("cartStep1");
const step2 = $("cartStep2");
const step3 = $("cartStep3");

const tab1 = $("tabStep1");
const tab2 = $("tabStep2");
const tab3 = $("tabStep3");

/* ===== State ===== */
let DATA = null;
let PRODUCTS = [];
let BY_ID = {};
let CATEGORY = null;      // categor√≠a seleccionada (null = ver todo)
let SUBCAT = null;        // subcategor√≠a seleccionada (null = todas)
let QUERY = "";
let CURRENT_PRODUCT = null;

let CART = [];            // [{id, qty}]
let STEP = 1;

/* ===== Overlay helpers ===== */
function showOverlay(){ overlay.classList.remove("hidden"); }
function hideOverlay(){ overlay.classList.add("hidden"); }

function openModal(modal){
  showOverlay();
  modal.classList.remove("hidden");
}
function closeModal(modal){
  modal.classList.add("hidden");
  // Si ning√∫n modal abierto, quita overlay
  const anyOpen = !productModal.classList.contains("hidden") || !cartModal.classList.contains("hidden");
  if(!anyOpen) hideOverlay();
}

/* ===== Theme ===== */
function applyTheme(){
  const saved = localStorage.getItem(THEME_KEY) || "dark";
  document.body.classList.toggle("light", saved==="light");
  $("btnTheme").textContent = saved==="light" ? "‚òÄÔ∏è" : "üåô";
}
function toggleTheme(){
  const isLight = document.body.classList.contains("light");
  localStorage.setItem(THEME_KEY, isLight ? "dark" : "light");
  applyTheme();
}

/* ===== Cart storage ===== */
function loadCart(){
  try{ CART = JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }
  catch{ CART=[]; }
  if(!Array.isArray(CART)) CART=[];
  updateCartBadge();
}
function saveCart(){
  localStorage.setItem(CART_KEY, JSON.stringify(CART));
  updateCartBadge();
}
function updateCartBadge(){
  const count = CART.reduce((a,it)=>a + Number(it.qty||0), 0);
  $("cartCount").textContent = String(count);
}

/* ===== Cart math ===== */
function cartSubtotal(){
  return CART.reduce((sum,it)=>{
    const p = BY_ID[it.id];
    if(!p) return sum;
    return sum + (Number(p.precio||0) * Number(it.qty||0));
  },0);
}
function renderCart(){
  cartList.innerHTML = "";

  if(CART.length===0){
    cartEmpty.style.display = "block";
  }else{
    cartEmpty.style.display = "none";
  }

  CART.forEach((it, idx)=>{
    const p = BY_ID[it.id];
    if(!p) return;

    const row = document.createElement("div");
    row.className = "cartRow";
    row.innerHTML = `
      <div style="flex:1;min-width:0">
        <div style="font-weight:900;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${p.nombre}</div>
        <small style="color:var(--muted)">${money(p.precio)} ¬∑ Cant: ${it.qty}</small>
      </div>
      <div class="qty">
        <button type="button" class="qtyMinus">-</button>
        <span class="qtyNum">${it.qty}</span>
        <button type="button" class="qtyPlus">+</button>
        <button type="button" class="qtyDel" title="Eliminar">üóëÔ∏è</button>
      </div>
    `;

    row.querySelector(".qtyMinus").onclick = ()=>{
      it.qty = Math.max(1, it.qty-1);
      saveCart();
      renderCart();
      renderCartTotals();
    };
    row.querySelector(".qtyPlus").onclick = ()=>{
      // stock limit
      const stock = Number(p.stock||0);
      if(stock>0 && it.qty+1 > stock){
        alert("Stock disponible: " + stock);
        return;
      }
      it.qty++;
      saveCart();
      renderCart();
      renderCartTotals();
    };
    row.querySelector(".qtyDel").onclick = ()=>{
      CART.splice(idx,1);
      saveCart();
      renderCart();
      renderCartTotals();
    };

    cartList.appendChild(row);
  });

  renderCartTotals();
}
function renderCartTotals(){
  const sub = cartSubtotal();
  cartSubtotalEl.textContent = money(sub);
  cartTotalEl.textContent = money(sub); // env√≠o/pago lo ajustamos con tu audio despu√©s
}

/* ===== Steps ===== */
function setStep(n){
  STEP = n;
  step1.style.display = (n===1) ? "block" : "none";
  step2.style.display = (n===2) ? "block" : "none";
  step3.style.display = (n===3) ? "block" : "none";

  tab1.classList.toggle("active", n===1);
  tab2.classList.toggle("active", n===2);
  tab3.classList.toggle("active", n===3);
}
tab1.onclick = ()=>setStep(1);
tab2.onclick = ()=>setStep(2);
tab3.onclick = ()=>setStep(3);

btnBack.onclick = ()=>{
  if(STEP>1) setStep(STEP-1);
};
btnNext.onclick = ()=>{
  if(STEP===1){
    if(CART.length===0){ alert("Tu carrito est√° vac√≠o."); return; }
    setStep(2);
    return;
  }
  if(STEP===2){
    // validaci√≥n m√≠nima
    const name = safe($("custName").value);
    const addr = safe($("custAddress").value);
    if(name.length<3){ alert("Escribe tu nombre."); return; }
    if(addr.length<6){ alert("Escribe tu direcci√≥n / referencia."); return; }
    setStep(3);
    return;
  }
  if(STEP===3){
    sendWhatsApp();
  }
};

/* ===== WhatsApp ===== */
function sendWhatsApp(){
  if(CART.length===0){ alert("Carrito vac√≠o"); return; }

  const name = safe($("custName").value);
  const phone = safe($("custPhone").value);
  const addr = safe($("custAddress").value);

  let lines = [];
  lines.push("üõí PEDIDO SDC");
  lines.push("");
  if(name) lines.push("üë§ " + name);
  if(phone) lines.push("üìû " + phone);
  if(addr) lines.push("üìç " + addr);
  lines.push("");
  lines.push("Productos:");
  CART.forEach(it=>{
    const p = BY_ID[it.id];
    if(!p) return;
    lines.push(`- ${it.qty} x ${p.nombre} (${money(p.precio)})`);
  });
  lines.push("");
  lines.push("Total: " + money(cartSubtotal()));

  const url = `https://wa.me/${WA_NUMBER}?text=${encodeURIComponent(lines.join("\n"))}`;
  window.open(url, "_blank");
}

$("btnSendWhatsApp").onclick = sendWhatsApp;

/* ===== Products: sort/filter ===== */
function getCategories(){
  // sin ‚ÄúTodas‚Äù en categor√≠as (solo subcategor√≠as)
  const base = (DATA?.categorias && DATA.categorias.length)
    ? DATA.categorias
        .filter(c => String(c.visible ?? 1) === "1" || c.visible === 1 || c.visible === true)
        .sort((a,b)=>Number(a.orden||999999)-Number(b.orden||999999))
        .map(c=>safe(c.categoria))
        .filter(Boolean)
    : [...new Set(PRODUCTS.map(p=>p.categoria).filter(Boolean))].sort((a,b)=>a.localeCompare(b));

  const cats = [];
  // OFERTAS autom√°tico si hay ofertas
  if(PRODUCTS.some(isOffer)) cats.push("OFERTAS");
  base.forEach(c=>{ if(c && c!=="OFERTAS") cats.push(c); });
  return cats;
}

function getSubcategories(cat){
  if(!cat || cat==="OFERTAS") return [];
  return [...new Set(PRODUCTS.filter(p=>p.categoria===cat).map(p=>p.subcategoria).filter(Boolean))]
    .sort((a,b)=>a.localeCompare(b));
}

function filteredProducts(){
  let list = [...PRODUCTS];

  if(CATEGORY){
    if(CATEGORY==="OFERTAS"){
      list = list.filter(isOffer);
    } else {
      list = list.filter(p=>p.categoria===CATEGORY);
    }
  }
  if(SUBCAT){
    list = list.filter(p=>p.subcategoria===SUBCAT);
  }
  const q = (QUERY||"").toLowerCase().trim();
  if(q){
    list = list.filter(p=>
      (p.nombre||"").toLowerCase().includes(q) ||
      (p.descripcion||"").toLowerCase().includes(q) ||
      (p.subcategoria||"").toLowerCase().includes(q)
    );
  }

  // Orden: disponibles -> orden -> nombre -> agotados
  list.sort((a,b)=>{
    const av = a.stock>0 ? 0 : 1;
    const bv = b.stock>0 ? 0 : 1;
    if(av!==bv) return av-bv;
    const ao = Number(a.orden||999999);
    const bo = Number(b.orden||999999);
    if(ao!==bo) return ao-bo;
    return (a.nombre||"").localeCompare(b.nombre||"");
  });

  return list;
}

function renderCategories(){
  catsWrap.innerHTML = "";

  // Bot√≥n ‚ÄúVer todo‚Äù
  const btnAll = document.createElement("button");
  btnAll.className = "chip" + (!CATEGORY ? " active" : "");
  btnAll.textContent = "VER TODO";
  btnAll.onclick = ()=>{
    CATEGORY=null;
    SUBCAT=null;
    renderCategories();
    renderSubcategories();
    renderProducts();
  };
  catsWrap.appendChild(btnAll);

  getCategories().forEach(cat=>{
    const b = document.createElement("button");
    b.className = "chip" + (CATEGORY===cat ? " active":"");
    b.textContent = cat;
    b.onclick = ()=>{
      CATEGORY = cat;
      SUBCAT = null;
      renderCategories();
      renderSubcategories();
      renderProducts();
    };
    catsWrap.appendChild(b);
  });
}

function renderSubcategories(){
  subWrap.innerHTML = "";

  const subs = getSubcategories(CATEGORY);
  if(!CATEGORY || CATEGORY==="OFERTAS" || subs.length===0){
    subWrap.style.display = "none";
    return;
  }
  subWrap.style.display = "flex";

  const bAll = document.createElement("button");
  bAll.className = "chip" + (!SUBCAT ? " active":"");
  bAll.textContent = "Todas";
  bAll.onclick = ()=>{
    SUBCAT=null;
    renderSubcategories();
    renderProducts();
  };
  subWrap.appendChild(bAll);

  subs.forEach(su=>{
    const b = document.createElement("button");
    b.className = "chip" + (SUBCAT===su ? " active":"");
    b.textContent = su;
    b.onclick = ()=>{
      SUBCAT=su;
      renderSubcategories();
      renderProducts();
    };
    subWrap.appendChild(b);
  });
}

function renderProducts(){
  const list = filteredProducts();
  productsTitle.textContent = `${CATEGORY ? CATEGORY : "Productos"} (${list.length})`;

  grid.innerHTML = "";
  if(list.length===0){
    grid.innerHTML = `<div class="loading">No hay productos para mostrar.</div>`;
    return;
  }

  list.forEach(p=>{
    const card = document.createElement("div");
    card.className = "card" + (isOut(p) ? " agotado":"") + (isOffer(p) ? " oferta":"");

    const oldHtml = isOffer(p) ? `<div class="old">${money(p.precio_anterior)}</div>` : "";
    const btnHtml = isOut(p)
      ? `<button class="btn btnDisabled" disabled>Agotado</button>`
      : `<button class="btn btnPrimary">Ver detalles</button>`;

    card.innerHTML = `
      <img src="${p.imagen||""}" alt="">
      <div class="cardBody">
        <div class="cardTitle">${p.nombre}</div>
        <div class="cardDesc">${p.descripcion||""}</div>
        <div class="priceRow">
          <div class="price">${money(p.precio)}</div>
          ${oldHtml}
        </div>
        ${btnHtml}
      </div>
    `;

    // Tocar toda la tarjeta abre detalles
    if(!isOut(p)){
      card.onclick = ()=>openProductModal(p);
    }

    grid.appendChild(card);
  });
}

/* ===== Modal producto + galer√≠a ===== */
function openProductModal(p){
  CURRENT_PRODUCT = p;

  modalProductName.textContent = p.nombre;
  modalProductSub.textContent = `${p.categoria}${p.subcategoria?(" ¬∑ "+p.subcategoria):""}`;
  modalPrice.textContent = money(p.precio);
  modalOldPrice.textContent = isOffer(p) ? money(p.precio_anterior) : "";
  modalDesc.textContent = p.descripcion || "";

  // galer√≠a
  const gallery = [];
  if(p.imagen) gallery.push(p.imagen);
  for(let i=1;i<=8;i++){
    const g = p[`galeria_${i}`];
    if(g) gallery.push(g);
  }
  const uniq = [...new Set(gallery.filter(Boolean))].slice(0,8);

  modalMainImage.src = uniq[0] || "";
  modalThumbs.innerHTML = "";
  if(uniq.length<=1){
    modalThumbs.classList.add("hidden");
  }else{
    modalThumbs.classList.remove("hidden");
    uniq.forEach((src, idx)=>{
      const im = document.createElement("img");
      im.src = src;
      im.className = "thumb" + (idx===0 ? " active":"");
      im.onclick = ()=>{
        modalMainImage.src = src;
        qsaThumbs().forEach(x=>x.classList.remove("active"));
        im.classList.add("active");
      };
      modalThumbs.appendChild(im);
    });
  }

  // video
  modalVideoButtons.innerHTML = "";
  const v = safe(p.video);
  if(v){
    modalVideoButtons.classList.remove("hidden");
    const a = document.createElement("a");
    a.href = v;
    a.target = "_blank";
    a.rel = "noopener";
    a.className = "vbtn";
    a.textContent = "Ver video";
    modalVideoButtons.appendChild(a);
  }else{
    modalVideoButtons.classList.add("hidden");
  }

  modalHint.textContent = "";
  openModal(productModal);
}

function qsaThumbs(){ return [...modalThumbs.querySelectorAll("img")]; }

/* ===== Modal product buttons ===== */
btnAddToCart.onclick = ()=>{
  if(!CURRENT_PRODUCT) return;
  if(isOut(CURRENT_PRODUCT)){ toast("Agotado"); return; }

  const stock = Number(CURRENT_PRODUCT.stock||0);
  let it = CART.find(x=>x.id===CURRENT_PRODUCT.id);
  if(!it){
    CART.push({id:CURRENT_PRODUCT.id, qty:1});
  }else{
    if(stock>0 && it.qty+1 > stock){
      alert("Stock disponible: "+stock);
      return;
    }
    it.qty++;
  }
  saveCart();
  modalHint.textContent = "‚úÖ Agregado. Seguir comprando o ir a pagar.";
};
btnKeepBuying.onclick = ()=>closeModal(productModal);
btnGoPay.onclick = ()=>{
  closeModal(productModal);
  openCart();
};

/* ===== Cart open ===== */
function openCart(){
  STEP=1;
  setStepUI(1);
  renderCart();
  openModal(cartModal);
}

function setStepUI(n){
  STEP = n;
  step1.classList.toggle("hidden", n!==1);
  step2.classList.toggle("hidden", n!==2);
  step3.classList.toggle("hidden", n!==3);

  tab1.classList.toggle("active", n===1);
  tab2.classList.toggle("active", n===2);
  tab3.classList.toggle("active", n===3);

  btnBack.style.display = (n===1) ? "none" : "inline-block";
  btnNext.textContent = (n===3) ? "Enviar" : "Continuar";
}

tab1.onclick = ()=>setStepUI(1);
tab2.onclick = ()=>setStepUI(2);
tab3.onclick = ()=>setStepUI(3);

btnBack.onclick = ()=>{ if(STEP>1) setStepUI(STEP-1); };
btnNext.onclick = ()=>{
  if(STEP===1){
    if(CART.length===0){ alert("Carrito vac√≠o"); return; }
    setStepUI(2);
  }else if(STEP===2){
    const n = safe($("custName").value);
    const a = safe($("custAddress").value);
    if(n.length<3){ alert("Escribe tu nombre"); return; }
    if(a.length<6){ alert("Escribe tu direcci√≥n"); return; }
    setStepUI(3);
  }else{
    sendWhatsApp();
  }
};

/* ===== Buttons close ===== */
$("closeProductModal").onclick = ()=>closeModal(productModal);
$("closeCartModal").onclick = ()=>closeModal(cartModal);

$("btnCart").onclick = openCart;

/* ===== Search + theme + overlay ===== */
$("btnTheme").onclick = toggleTheme;
$("btnSearch").onclick = ()=>$("searchInput").focus();
$("btnTheme").onclick = toggleTheme;

overlay.onclick = ()=>{
  closeModal(productModal);
  closeModal(cartModal);
};

/* ===== Init ===== */
function init(){
  applyTheme();
  loadCart();

  // no dependemos de categorias sheet para que nunca quede vac√≠o
  loadAPI().catch(err=>{
    grid.innerHTML = `<div class="loading">Error cargando cat√°logo: ${String(err.message||err)}</div>`;
  });
}

init();
</script>

</body>
</html>
```Ó®Å0Ó®Ç